<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>digvijay q1</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <style>
        table,
        th,
        tr,
        td {
            padding: 5px;
            border: solid;
            text-align: center;
        }
        #chart-container {
            position: relative;
            height: 90vh;
            width: 80%;
            overflow: hidden;
            }
            #chart-container {
            position: relative;
            height: 90vh;
            width: 80%;
            overflow: hidden;
            }
        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }
            to { 
                transform: rotate(360deg);
            }
        }

        @-webkit-keyframes rotate {
            from {
                -webkit-transform: rotate(0deg);
            }
            to { 
                -webkit-transform: rotate(360deg);
            }
        }

        .load {
            position: absolute;
            width: 100px;
            height: 100px;
            margin-left: calc(50vw - 50px);
            margin-top: calc(50vh - 50px);
            border:solid 10px blue;
            border-radius: 50%;
            border-right-color: transparent;
            border-bottom-color: transparent;
            -webkit-transition: all 0.5s ease-in;
            -webkit-animation-name:             rotate; 
            -webkit-animation-duration:         1.0s; 
            -webkit-animation-iteration-count:  infinite;
            -webkit-animation-timing-function: linear;
                
                transition: all 0.5s ease-in;
            animation-name:             rotate; 
            animation-duration:         1.0s; 
            animation-iteration-count:  infinite;
            animation-timing-function: linear; 
        }
        #fade{
            filter: blur(5px);
        }
    </style>
</head>
<body>
    <div class="load"></div>
    <div id="fade">
        <h2> What is the trend in the opening and closing ranks for popular branches?</h2>
    <div class="form-check form-switch">
    <input class="form-check-input" type="checkbox" role="switch" onchange=changeData() id="flexSwitchCheckDefault">
    <label class="form-check-label" for="flexSwitchCheckDefault">Closing Rank </label>
    </div>
    <div id="chart-container"></div>

    <table id="data_table">
        <tr>
            <th>SI No</th>
            <th>Institute Name</th>
            <th>Institute Type</th>
            <th>Program</th>
            <th>Seat Type</th>
            <th>Gender</th>
            <th>Opening Rank</th>
            <th>Closing Rank</th>
            <th>Year</th>
            <th>Round No</th>
        </tr>
        {% for data in alldata %}
        <tr>
            <td>{{forloop.counter}}</td>
            <td>{{data.institute}}</td>
            <td>{{data.institute_type}}</td>
            <td>{{data.program}}</td>
            <td>{{data.seat_type}}</td>
            <td>{{data.gender}}</td>
            <td>{{data.opening_rank}}</td>
            <td>{{data.closing_rank}}</td>
            <td>{{data.year}}</td>
            <td>{{data.roundNo}}</td>
        </tr>
        {% endfor %}
    </table>

</div>
    <script src="https://fastly.jsdelivr.net/npm/echarts@5.4.2/dist/echarts.min.js" async></script>

    <script>
        window.addEventListener('load', function() {
            var loadingScreen = document.getElementsByClassName('load')[0];
            loadingScreen.style.display = 'none';
            document.getElementById('fade').style.filter='none';    
            var dom = document.getElementById("chart-container");
        var myChart = echarts.init(dom, null, {
            renderer: "canvas",
            useDirtyRect: false,
        });


        var series1 = [];
        colors = ['#ae1029','#0065c2','#26c238', '#9876aa', '#fb8649', 
            '#57904b','#d35b5c'];
        for (var i = 0; i < opening_ranks.length;i++) {
            series1.push({
                name:branches[i],
                type: "line",
                data: opening_ranks[i],
                smooth: true, 
                symbolSize: 3,
                // color:colors[i],
                // yAxisIndex: 0,
            }
            );
        }
        var series2 = [];
        colors = ['#ae1029','#0065c2','#26c238', '#9876aa', '#fb8649', 
            '#57904b','#d35b5c'];
        for (var i = 0; i < closing_ranks.length;i++) {
            series2.push(
            {
                name:branches[i],
                type: "line",
                data: closing_ranks[i],
                smooth: true, 
                symbolSize: 3,
                // yAxisIndex: 1,
            },
            );
        }

        // console.log(series);
        var isClosing = 0;
        var text = '';
        if(isClosing){
            text = 'Trend of Closing ranks over different years.'
        }
        else{
            text = 'Trend of Opening ranks over different years.'
        }
        option = {
                title: {
                    text: text,
                    bottom:0,
                    left:350,
                    // bottom:'middle',
                    textStyle: {
                        fontSize: 20,
                    },
                }, 
                tooltip: {
                    trigger: "axis",
                },
                legend: {
                    zLevel: 1,
                    orient:'vertical',
                    type:'scroll',
                    top:25,
                    // itemHeight:2,
                }, 
                series: series1,
                grid: {
                    left: "5%",
                    right: "7%",
                    bottom: "8%",
                    containLabel: true,
                },
                toolbox: {
                },
                xAxis: {
                    type: "category",
                    boundaryGap: true,
                    data: years,
                    name:'Years',
                },
                yAxis: [
                    {
                        type: "value",
                        boundaryGap:true,
                        scale:true,
                        name: isClosing ? 'Closing Ranks' : 'Opening Ranks',
                    },
                ]
            }
            if (option && typeof option === "object") {
                        myChart.setOption(option);
                }

            function changeData(){
                var isChecked = document.getElementById('flexSwitchCheckDefault').checked;
                console.log(isChecked);
                // var table = document.getElementById('data_table');
                if(isChecked) {
                    if (option && typeof option === "object") {
                        option.series = series2;
                        myChart.setOption(option);
                    }
                    // table.style.display = 'block';
                }
                else{
                    if (option && typeof option === "object") {
                        option.series = series1;
                        myChart.setOption(option);
                    }
                    // table.style.display = 'none';
                }
            }
            window.addEventListener("resize", myChart.resize);
        
        })
        var dataString = '{{ jsdata|safe }}';
        var data = JSON.parse(dataString);
    
        // console.log(data);

        years = [];
        colleges = [];
        opening_ranks = [];
        closing_ranks =[];
        branches =[];

        function removeDuplicates(arr) {
            return [...new Set(arr)];
        }

        for(var i = 0;i<data.length;i++){
            years.push(data[i].year);
            colleges.push(data[i].institute);
            branches.push(data[i].program);
        }
        colleges = removeDuplicates(colleges);
        years = removeDuplicates(years);
        branches = removeDuplicates(branches);

        // console.log(colleges);
        for(var k = 0 ;k<branches.length ;k++) {
            temp1 = [];
            temp2 = [];
            for(var i = 0; i < years.length; i++){
                var sum1 = 0;
                var sum2 = 0;
                for(var j = 0;j<data.length;j++){
                    if(data[j].program == branches[k]){
                        if(data[j].year == years[i]){
                            sum1 += parseInt( data[j].opening_rank, 10); //don't forget to add the base
                            sum2 += parseInt( data[j].closing_rank, 10); //don't forget to add the base
                        }
                    }
                }
                var avg1 = sum1/colleges.length;
                avg1 = Math.round(avg1);
                var avg2 = sum2/colleges.length;
                avg2 = Math.round(avg2);
                temp1.push(avg1);
                temp2.push(avg2);
            }
            opening_ranks.push(temp1);
            closing_ranks.push(temp2);
        }
        console.log(opening_ranks);



        
        

    </script>
</body>
</html>