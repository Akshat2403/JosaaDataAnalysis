<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>siddhant q3</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <style>
        table,
        th,
        tr,
        td {
            padding: 5px;
            border: solid;
            text-align: center;
        }
        #chart-container {
            position: relative;
            height: 90vh;
            width: 80%;
            overflow: hidden;
            }
    </style>
</head>
<body>
    <h2> What is the average rank of students admitted to the IITs in different branches?</h2>
    <div id="chart-container"></div>

   

    <script src="https://fastly.jsdelivr.net/npm/echarts@5.4.2/dist/echarts.min.js"></script>

    <script>
          var dataString = '{{ jsdata|safe }}';
          var data = JSON.parse(dataString);
        // console.log(data);
        colleges=[];
        years = [];
        opening_ranks = [];
        closing_ranks = [];
        branches = [];
        other_branches=[];
        rank_average = [];
    
        function removeDuplicates(arr) {
            return [...new Set(arr)];
        }
    
        for (var i = 0; i < data.length; i++) {
            years.push(data[i].year);
            other_branches.push(data[i].program);
            colleges.push(data[i].institute);
        }
        console.log(colleges);

        for(var i=0;i<20;i++){
            branches.push(data[i].program);
        }
        colleges = removeDuplicates(colleges);
        years = removeDuplicates(years);
        branches = removeDuplicates(branches);
        other_branches=removeDuplicates(other_branches);
        other_branches = other_branches.filter(item => !branches.includes(item));
        var rank_avgSum=0;
        // console.log(colleges);
        for (var k = 0; k < branches.length; k++) {
            var avg1=0;
            var avg2=0;
            for (var i = 0; i < years.length; i++) {
                var sum1 = 0;
                var sum2 = 0;
                for (var j = 0; j < data.length; j++) {
                    if (data[j].program == branches[k]) {
                        if (data[j].year == years[i]) {
                            sum1 += parseInt(data[j].opening_rank, 10); //don't forget to add the base
                            sum2 += parseInt(data[j].closing_rank, 10); //don't forget to add the base
                        }
                    }
                }
                avg1 += sum1 / colleges.length;
                avg1 = Math.round(avg1);
                avg2 += sum2 / colleges.length;
                avg2 = Math.round(avg2);
                console.log(avg1);
            }
    
            var rank_avg = ((avg2 + avg1)/2)/years.length;
            rank_average.push(rank_avg);
        }
        for (var k = 0; k < other_branches.length; k++) {
            var avg1=0;
            var avg2=0;
            for (var i = 0; i < years.length; i++) {
                var sum1 = 0;
                var sum2 = 0;
                for (var j = 0; j < data.length; j++) {
                    if (data[j].program == other_branches[k]) {
                        if (data[j].year == years[i]) {
                            sum1 += parseInt(data[j].opening_rank, 10); //don't forget to add the base
                            sum2 += parseInt(data[j].closing_rank, 10); //don't forget to add the base
                        }
                    }
                }
                avg1 = sum1 / colleges.length;
                avg1 = Math.round(avg1);
                 avg2 = sum2 / colleges.length;
                avg2 = Math.round(avg2);
            }
             rank_avgSum+=((avg2+avg1)/2)/years.length;
            
        }
        rank_average.push(rank_avgSum/other_branches.length);
        branches.push("Other Branches",other_branches);
        var dom = document.getElementById("chart-container");
        var myChart = echarts.init(dom, null, {
            renderer: "canvas",
            useDirtyRect: false,
        });
    
        var series1 = [];
        colors = [
            "#ae1029",
            "#0065c2",
            "#26c238",
            "#9876aa",
            "#fb8649",
            "#57904b",
            "#d35b5c",
        ];
        series1.push({
            name: "Average Ranks",
            type: "line",
            data: rank_average,
            smooth: true,
            symbolSize: 3,
        });
    
        // console.log(series);
        var text = "Trend of Rank Average between Opening and Closing Ranks over Different Branches.";
        option = {
            title: {
                text: text,
                bottom: 0,
                left: 350,
                textStyle: {
                    fontSize: 20,
                },
            },
            tooltip: {
                trigger: "axis",
            },
            legend: {
                zLevel: 1,
                orient: "vertical",
                type: "scroll",
                top: 25,
            },
            series: series1,
            grid: {
                left: "5%",
                right: "7%",
                bottom: "8%",
                containLabel: true,
            },
            toolbox: {},
            xAxis: {
                type: "category",
                boundaryGap: true,
                data: branches,
                name: "Branches",
            },
            yAxis: [
                {
                    type: "value",
                    boundaryGap: true,
                    scale: true,
                    name: " Ranks",
                },
            ],
        };
        if (option && typeof option === "object") {
            myChart.setOption(option);
        }
    
        function changeData() {
            var isChecked = document.getElementById("flexSwitchCheckDefault").checked;
            console.log(isChecked);
            if (isChecked) {
                if (option && typeof option === "object") {
                    option.series = series1;
                    myChart.setOption(option);
                }
            } else {
                if (option && typeof option === "object") {
                    option.series = series1;
                    myChart.setOption(option);
                }
            }
        }
        window.addEventListener("resize", myChart.resize);
    </script>
    
</body>
</html>