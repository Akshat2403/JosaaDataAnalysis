<!DOCTYPE html>
{% load static %}
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
        <title>All Dats</title>
        <style>
            table,
            th,
            tr,
            td {
                padding: 5px;
                border: solid;
            }
            #chart {
                width: 600px;
            }
            #chart-container {
            position: relative;
            height: 60vh;
            width: 55%;
            overflow: hidden;
            }
        </style>
    </head>
    <body>
        <form method="post">
{% csrf_token %}
        <div style="padding: 20px;">
            <!-- Filter -->
            <div class="border-bottom pb-3">
              <div class="row justify-content-md-start align-items-md-center">
                <div class="col-md-4 mb-3 mb-md-0">
                  <h5 class="mb-0"><span class="text-dark fw-semibold">Select</span> to get started</h5>
                </div>
                <!-- End Col -->
            
                <div class="col-md-6 text-md-end">
                  <div class="row gx-2">
                    <div class="col-auto mb-2">
                      <!-- Select -->
                      <select class="form-select form-select-sm" name="college_name">
                        <option disabled selected value="0">Select College</option>
                        {% for college in colleges %}
                        <option value="{{college.0}}">{{college.1}}</option>
                        {% endfor %}
                      </select>
                      <!-- End Select -->
                    </div>
                    <!-- End Col -->
            
                    <div class="col-auto mb-2">
                      <!-- Select -->
                      <select class="form-select form-select-sm" name="branch_name">
                        <option disabled selected value="0">Select Branch</option>
                        {% for branch in branches %}
                        <option value="{{branch.0}}">{{branch.1}}</option>
                        {% endfor %}
                      </select>
                      <!-- End Select -->
                    </div>
                    <!-- End Col -->
            
                    <div class="col-auto mb-2">
                      <!-- Select -->
                      <select class="form-select form-select-sm" name="seat_type">
                        <option disabled selected value="0">Seat Type</option>
                        {% for seattype in seat_types %}
                        <option value="{{seattype.0}}">{{seattype.1}}</option>
                        {% endfor %}
                      </select>
                      <!-- End Select -->
                    </div>
                    <!-- End Col -->
            
                    <div class="col-auto mb-2">
                      <!-- Select -->
                      <select class="form-select form-select-sm" name="gender">
                        <option disabled selected value="0">Gender</option>
                        {% for gen in genders %}
                        <option value="{{gen.0}}">{{gen.1}}</option>
                        {% endfor %}
                      </select>
                      <!-- End Select -->
                      
                    </div>

                    <input type="submit" value="Search">
                    <!-- End Col -->
                  </div>
                  <!-- End Row -->
                </div>
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" role="switch" onchange=showTable() id="flexSwitchCheckDefault">
                  <label class="form-check-label" for="flexSwitchCheckDefault">Show Table</label>
                </div>
                <!-- End Col -->
              </div>
              <!-- End Row -->
            </div>
            <!-- End Filter -->
        </div>

    </form>

        <div id="chart-container"></div>

        {% if jsdata %}
        <table id="data_table" style="display: none;">
            <tr>
                <th>SI No</th>
                <th>Institute Name</th>
                <th>Institute Type</th>
                <th>Program</th>
                <th>Seat Type</th>
                <th>Gender</th>
                <th>Opening Rank</th>
                <th>Closing Rank</th>
                <th>Year</th>
                <th>Round No</th>
            </tr>
            {% for data in alldata %}
            <tr>
                <td>{{forloop.counter}}</td>
                <td>{{data.institute}}</td>
                <td>{{data.institute_type}}</td>
                <td>{{data.program}}</td>
                <td>{{data.seat_type}}</td>
                <td>{{data.gender}}</td>
                <td>{{data.opening_rank}}</td>
                <td>{{data.closing_rank}}</td>
                <td>{{data.year}}</td>
                <td>{{data.roundNo}}</td>
            </tr>
            {% endfor %}
        </table>
{% endif %}
        <script src="./assets/vendor/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

        <script src="https://fastly.jsdelivr.net/npm/echarts@5.4.2/dist/echarts.min.js"></script>

        <script>
            var dom = document.getElementById("chart-container");
            var myChart = echarts.init(dom, null, {
                renderer: "canvas",
                useDirtyRect: false,
            });
            var app = {};
            function showTable(){
                var isChecked = document.getElementById('flexSwitchCheckDefault').checked;
                console.log(isChecked);
                var table = document.getElementById('data_table');
                if(isChecked) {
                    table.style.display = 'block';
                }
                else{
                    table.style.display = 'none';
                }
            }
            var option;
            var dataString = '{{ jsdata|safe }}';
            console.log(dataString);
            var data = JSON.parse(dataString);

            var years = [];
            var yearwise_data = [];

            for (var i = 0; i < data.length; i++) {
                years.push(data[i].year);
            }
            
            function removeDuplicates(years) {
                return [...new Set(years)];
            }
            years = removeDuplicates(years);
            console.log(years);
            for(var i = 0; i < years.length;i++ ){
                var temp = [];
                for (var j = 0; j < data.length; j++) {
                    if(data[j].year == years[i]){
                        temp.push(data[j].closing_rank)
                    }
                }

                console.log(temp);
                yearwise_data.push(temp);
            }
            console.log(yearwise_data);

            var series = [];
            var i = 0;
            colors = ['#ae1029','#0065c2','#26c238', '#9876aa', '#fb8649', 
             '#57904b','#d35b5c'];
            for (const tempdata of yearwise_data ?? []) {
                series.push({
                    name:years[i++],
                    type: "line",
                    data: tempdata,
                    smooth: true, 
                    color:colors[i],
                    
                    symbolSize: 3,
                });
            }

            console.log(series);

            option = {
                title: {
                    text: "YearWise Closing Rank for All Rounds",
                },
                tooltip: {
                    trigger: "axis",
                },
                legend: {
                    zlevel: 1,
                    orient:'vertical',
                    right:0,
                }, 
                series: series,
                grid: {
                    left: "5%",
                    right: "7%",
                    bottom: "8%",
                    containLabel: true,
                },
                toolbox: {
                },
                xAxis: {
                    type: "category",
                    boundaryGap: true,
                    data: ["Round 1","Round 2","Round 3","Round 4","Round 5","Round 6","Round 7"],
                },
                yAxis: {
                    type: "value",
                    boundaryGap:true,
                    scale:true,
                },
            }

            if (option && typeof option === "object") {
                myChart.setOption(option);
            }

            window.addEventListener("resize", myChart.resize);
        </script>

    </body>
</html>
