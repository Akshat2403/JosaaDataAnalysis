<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>siddhant q2</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <style>
        table,
        th,
        tr,
        td {
            padding: 5px;
            border: solid;
            text-align: center;
        }
        #chart-container {
            position: relative;
            height: 90vh;
            width: 80%;
            overflow: hidden;
            }
    </style>
</head>
<body>
    <h2> What is the average rank difference between opening and closing rank of each branch?</h2>
    <div id="chart-container"></div>

   

    <script src="https://fastly.jsdelivr.net/npm/echarts@5.4.2/dist/echarts.min.js"></script>

    <script>
        var dataString = '{{ jsdata|safe }}';
        var data = JSON.parse(dataString);
        // console.log(data);
        var dom = document.getElementById("chart-container");
    var myChart = echarts.init(dom, null, {
        renderer: "svg", // Switch to "svg" rendering mode
        useDirtyRect: false,
    });
        colleges=[];
        years = [];
        opening_ranks = [];
        closing_ranks = [];
        branches = [];
        other_branches=[];
        rank_differences = [];
    
        function removeDuplicates(arr) {
            return [...new Set(arr)];
        }
    
        for (var i = 0; i < data.length; i++) {
            years.push(data[i].year);
            other_branches.push(data[i].program);
            colleges.push(data[i].institute);
        }
        for(var i=0;i<20;i++){
            branches.push(data[i].program);
        }
        colleges = removeDuplicates(colleges);
        years = removeDuplicates(years);
        branches = removeDuplicates(branches);
        other_branches=removeDuplicates(other_branches);
        other_branches = other_branches.filter(item => !branches.includes(item));
        var rank_diffsum=0;

        // console.log(colleges);
        for (var k = 0; k < branches.length; k++) {
            var avg1=0;
            var avg2=0;
            var collegenum=[];
            for (var i = 0; i < years.length; i++) {
                var sum1 = 0;
                var sum2 = 0;
                for (var j = 0; j < data.length; j++) {
                    if (data[j].program == branches[k]) {
                        if (data[j].year == years[i]) {
                            collegenum.push(data[j].institute);
                            sum1 += parseInt(data[j].opening_rank, 10); //don't forget to add the base
                            sum2 += parseInt(data[j].closing_rank, 10); //don't forget to add the base
                        }
                    }
                }
                avg1 += sum1 / collegenum.length;
                avg1 = Math.round(avg1);
                avg2 += sum2 / collegenum.length;
                avg2 = Math.round(avg2);
            }
            var rank_diff = (avg2 - avg1)/years.length;
            rank_differences.push(rank_diff);
        }
        for (var k = 0; k < other_branches.length; k++) {
            var avg1=0;
            var avg2=0;
            var collegenum=[];
            for (var i = 0; i < years.length; i++) {
                var sum1 = 0;
                var sum2 = 0;
                for (var j = 0; j < data.length; j++) {
                    if (data[j].program == other_branches[k]) {
                        if (data[j].year == years[i]) {
                            collegenum.push(data[j].institute);
                            sum1 += parseInt(data[j].opening_rank, 10); //don't forget to add the base
                            sum2 += parseInt(data[j].closing_rank, 10); //don't forget to add the base
                        }
                    }
                }
                 avg1 += sum1 / collegenum.length;
                avg1 = Math.round(avg1);
                 avg2 += sum2 / collegenum.length;
                avg2 = Math.round(avg2);
            }
             rank_diffsum+=(avg2-avg1)/years.length;
            
        }
        var labels=[];
       
        rank_differences.push(rank_diffsum/other_branches.length);
        branches.push("Other Branches",other_branches);
        labels.push[0];
        for(var i=1;i<17;i++){
            labels.push(branches[i]);
        }
        var dom = document.getElementById("chart-container");
        var myChart = echarts.init(dom, null, {
            renderer: "canvas",
            useDirtyRect: false,
        });
    
        var series1 = [];
        colors = [
            "#ae1029",
            "#0065c2",
            "#26c238",
            "#9876aa",
            "#fb8649",
            "#57904b",
            "#d35b5c",
        ];
        series1.push({
            name: "Rank Difference",
            type: "line",
            data: rank_differences,
            smooth: true,
            symbolSize: 3,
        });
        // console.log(series);
        var text = "Trend of Rank Differences between Opening and Closing Ranks over Different Branches.";
        option = {
            title: {
                text: text,
                bottom: 0,
                left: 350,
                textStyle: {
                    fontSize: 20,
                },
            },
            tooltip: {
                trigger: "axis",
            },
            legend: {
                zLevel: 1,
                orient: "vertical",
                type: "scroll",
                top: 25,
            },
            series: series1,
            grid: {
                left: "5%",
                right: "7%",
                bottom: "8%",
                containLabel: true,
            },
            toolbox: {},
            xAxis: {
                type: "category",
                boundaryGap: true,
                data:labels,
                name: "Branches",
                axisLabel: {
        fontSize:10,
        rotate:30 
    },
      
            },
            yAxis: [
                {
                    type: "value",
                    boundaryGap: true,
                    scale: true,
                    name: "Rank Difference",
                },
            ],
        };
        if (option && typeof option === "object") {
            myChart.setOption(option);
        }
    
       
    </script>
    
</body>
</html>